unit Ulistpenjualan;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.ExtCtrls, Data.DB,
  Vcl.Grids, Vcl.DBGrids, MemDS, DBAccess, MyAccess;

type
  TFlistpenjualan = class(TForm)
    Panel1: TPanel;
    Splitter1: TSplitter;
    Splitter2: TSplitter;
    Splitter3: TSplitter;
    Splitter4: TSplitter;
    Btambah: TButton;
    Btedit: TButton;
    Bthapus: TButton;
    Btrefresh: TButton;
    Panel2: TPanel;
    Label1: TLabel;
    Splitter5: TSplitter;
    Edcari: TEdit;
    DBGrid1: TDBGrid;
    Qpenjualan: TMyQuery;
    DSpenjualan: TDataSource;
    Qpenjualankode_penjualan: TStringField;
    Qpenjualantgl_penjualan: TDateField;
    Qpenjualankode_pelanggan: TStringField;
    Qpenjualanno_bukti: TStringField;
    Qpenjualannama_pelanggan: TStringField;
    Qpenjualantotal: TFloatField;
    procedure BteditClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Flistpenjualan: TFlistpenjualan;

implementation

{$R *.dfm}

uses UDM, Myfunction, Upenjualan;

procedure TFlistpenjualan.BteditClick(Sender: TObject);
begin
Application.CreateForm(TFpenjualan,Fpenjualan);
  status_simpan := 2;
  //master
  Fpenjualan.edkodepenjualan.Text := Qpenjualankode_penjualan.AsString;
  Fpenjualan.Dtpenjualan.DateTime := Qpenjualantgl_penjualan.AsDateTime;
  Fpenjualan.Edkodepelanggan.Text := Qpenjualankode_pelanggan.AsString;
  Fpenjualan.cbnama_pelanggan.Text := Qpenjualannama_pelanggan.AsString;
  Fpenjualan.Ednobukti.Text := Qpenjualanno_bukti.AsString;
  Fpenjualan.Edtotal.Text :=FloatToStr(Qpenjualantotal.AsFloat);
  Fpenjualan.Edbayar.Text :=FloatToStr(Qpenjualanbayar.AsFloat);
  Fpenjualan.Edkembali.Text :=FloatToStr(Qpenjualankembali.AsFloat);
  //detail
  with dm.Qtemp do
    begin
       SQL.Clear;
       sql.Text := 'select tpd.*,tb.nama_barang,tb.satuan from tpenjualan_detail tpd '+
       ' INNER JOIN tbarang tb ON tb.kode_barang=tpd.kode_barang '+
       ' WHERE tpd.kode_penjualan='+QuotedStr(Qpenjualankode_penjualan.AsString);
       Open;
      dm.Qtemp.First;
      while not dm.Qtemp.Eof do
      begin
        with Flistpenjualan do
        begin
          CDS1.Insert;
          CDS1kode_barang.Text := FieldByName('kode_barang').AsString;
          CDS1nama_barang.Text := FieldByName('nama_barang').AsString;
          CDS1satuan.Text := FieldByName('satuan').AsString;
          CDS1harga_jual.AsFloat := FieldByName('harga_jual').AsFloat;
          CDS1qty.AsFloat := FieldByName('qty').AsFloat;
          CDS1sub_total.AsFloat := FieldByName('sub_total').AsFloat;
          CDS1.Post;
        end;
        dm.Qtemp.Next;
      end;
    end;
  Ftambah_edit_penjualan.ShowModal;
  Ftambah_edit_penjualan.Free;
end;

end;

end.
